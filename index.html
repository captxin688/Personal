<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Personal Queue</title>
    <link rel="icon" href="Personal_8.png">
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@200;300;400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --border-color: rgba(255, 215, 0, 0.2);
            --text-main: #ffffff;
            --text-muted: #aaaaaa;
            --accent-color: #ff3333; 
            --accent-gold: #FFD700;
            --slot-bg: rgba(255, 255, 255, 0.05);
            --slot-occupied-bg: #B5251A; 
        }

        body {
            font-family: 'Kanit', sans-serif;
            margin: 0; padding: 40px 20px;
            color: var(--text-main); min-height: 100vh; background-color: #1a0505;
            overflow-x: hidden; display: flex; flex-direction: column;
        }

        #effectsCanvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; pointer-events: none; }

        .container {
            max-width: 1100px; margin: 0 auto; position: relative; z-index: 10;
            background: rgba(30, 10, 10, 0.85); 
            backdrop-filter: blur(12px);
            padding: 40px; border-radius: 16px; border: 1px solid var(--border-color);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5); width: 100%; box-sizing: border-box;
        }

        /* Header & Logo */
        header { text-align: center; margin-bottom: 30px; padding-bottom: 20px; border-bottom: 1px solid var(--border-color); }
        .main-logo { max-width: 250px; height: auto; margin-bottom: 15px; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.5)); display: block; margin-left: auto; margin-right: auto; }

        /* --- ปุ่มสเปคและราคา --- */
        .btn-specs {
            background: transparent;
            border: 1px solid var(--accent-gold);
            color: var(--accent-gold);
            padding: 8px 24px;
            border-radius: 30px;
            font-family: 'Kanit', sans-serif;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        .btn-specs:hover {
            background: var(--accent-gold);
            color: #8B0000;
            font-weight: bold;
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.4);
        }

        /* --- Modal Popup --- */
        .modal {
            display: none; position: fixed; z-index: 999; left: 0; top: 0;
            width: 100%; height: 100%; background-color: rgba(0,0,0,0.9);
            backdrop-filter: blur(5px); overflow: auto;
        }
        .modal-content {
            margin: 5% auto; display: block; width: 90%; max-width: 700px;
            border-radius: 8px; box-shadow: 0 0 20px rgba(255, 51, 51, 0.2);
            animation: zoomIn 0.3s ease;
        }
        .close-modal {
            position: absolute; top: 20px; right: 35px; color: #f1f1f1;
            font-size: 40px; font-weight: bold; transition: 0.3s; cursor: pointer; z-index: 1000;
        }
        .close-modal:hover { color: var(--accent-color); }
        @keyframes zoomIn { from {transform:scale(0.8); opacity:0} to {transform:scale(1); opacity:1} }

        /* Tabs & Schedule */
        .tabs { 
            display: flex; 
            justify-content: center; 
            margin-bottom: 30px; 
            gap: 15px; 
            flex-wrap: wrap; 
        }
        .tab-btn { padding: 12px 35px; border: 1px solid var(--border-color); background: rgba(255, 255, 255, 0.05); color: var(--text-muted); cursor: pointer; border-radius: 8px; font-family: 'Kanit', sans-serif; font-size: 16px; font-weight: 400; transition: all 0.3s ease; }
        .tab-btn:hover { background: rgba(255, 51, 51, 0.2); color: white; border-color: var(--accent-color); }
        .tab-btn.active { background: var(--accent-color); color: white; border-color: var(--accent-color); box-shadow: 0 0 15px rgba(255, 51, 51, 0.4); font-weight: 500; }

        .schedule-container {
            overflow-x: auto; border-radius: 8px; background: rgba(0, 0, 0, 0.3); padding: 10px; min-height: 60vh; width: 100%; box-sizing: border-box;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
        }
        .schedule-container.loaded { display: block; justify-content: flex-start; min-height: auto; }

        /* Radar Loader */
        .radar-loader { position: relative; width: 100px; height: 100px; margin-bottom: 20px; }
        .radar-ring { position: absolute; width: 100%; height: 100%; border-radius: 50%; border: 2px solid var(--accent-gold); box-shadow: 0 0 10px var(--accent-gold); opacity: 0; animation: radar-wave 2s cubic-bezier(0, 0.2, 0.8, 1) infinite; }
        .radar-ring:nth-child(2) { animation-delay: -0.6s; border-color: var(--accent-color); box-shadow: 0 0 10px var(--accent-color); }
        .radar-ring:nth-child(3) { animation-delay: -1.2s; }
        .radar-core { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 15px; height: 15px; background: var(--accent-gold); border-radius: 50%; box-shadow: 0 0 15px var(--accent-gold); animation: pulse-core 2s infinite; }
        @keyframes radar-wave { 0% { top: 50%; left: 50%; width: 0; height: 0; opacity: 1; border-width: 2px; } 100% { top: 0; left: 0; width: 100%; height: 100%; opacity: 0; border-width: 0px; } }
        @keyframes pulse-core { 0% { transform: translate(-50%, -50%) scale(0.8); opacity: 0.8; } 50% { transform: translate(-50%, -50%) scale(1.2); opacity: 1; } 100% { transform: translate(-50%, -50%) scale(0.8); opacity: 0.8; } }
        .loading-text { text-align: center; color: var(--text-main); font-size: 18px; font-weight: 300; letter-spacing: 1px; opacity: 0.8; }

        .scroll-hint { display: none; text-align: center; font-size: 12px; color: var(--accent-gold); margin-bottom: 5px; animation: pulse 2s infinite; }
        @media (max-width: 768px) { .scroll-hint { display: block; } }
        @keyframes pulse { 0% { opacity: 0.6; transform: translateX(0); } 50% { opacity: 1; transform: translateX(5px); } 100% { opacity: 0.6; transform: translateX(0); } }

        .schedule-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .legend { display: flex; gap: 20px; font-size: 14px; color: var(--text-muted); }
        .legend-item { display: flex; align-items: center; gap: 8px; }
        .dot { width: 10px; height: 10px; border-radius: 2px; }

        table { width: 100%; border-collapse: separate; border-spacing: 3px; min-width: 800px; }
        th, td { padding: 12px 8px; text-align: center; border-radius: 4px; }
        th { background-color: transparent; font-weight: 500; color: var(--text-muted); font-size: 14px; }
        .time-slot { font-size: 14px; border: 1px solid transparent; font-weight: 300; cursor: default; }
        .available { background-color: var(--slot-bg); color: var(--text-muted); }
        .occupied { background-color: var(--slot-occupied-bg); color: #ffffff; border: 1px solid rgba(255,255,255,0.05); }
        
        .why-us-section { margin-top: 40px; border-top: 1px solid var(--border-color); padding-top: 30px; }
        .why-us-header { text-align: center; font-size: 24px; font-weight: 600; margin-bottom: 30px; color: var(--text-main); }
        .features-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; width: 100%; }
        @media (min-width: 900px) { .features-grid { grid-template-columns: repeat(3, 1fr); } }
        .feature-card { background: rgba(255, 255, 255, 0.03); border: 1px solid var(--border-color); padding: 25px; border-radius: 12px; text-align: center; opacity: 0; transform: translateY(50px); transition: all 0.8s cubic-bezier(0.22, 1, 0.36, 1); }
        .feature-card.show { opacity: 1; transform: translateY(0); }
        .feature-card:hover { transform: translateY(-5px) !important; background: rgba(255, 51, 51, 0.1); border-color: var(--accent-gold); }
        .feature-icon { width: 48px; height: 48px; margin-bottom: 15px; fill: var(--accent-gold); filter: drop-shadow(0 0 8px rgba(255, 215, 0, 0.4)); }
        .feature-title { font-size: 18px; font-weight: 500; margin-bottom: 10px; color: #fff; }
        .feature-desc { font-size: 14px; color: var(--text-muted); line-height: 1.6; font-weight: 300; }

        .site-footer { margin-top: 60px; border-top: 1px solid var(--border-color); padding-top: 40px; text-align: center; display: flex; flex-direction: column; align-items: center; gap: 20px; }
        .footer-brand { font-size: 28px; font-weight: 600; letter-spacing: 2px; color: var(--text-main); text-transform: uppercase; position: relative; display: inline-block; }
        .footer-brand::after { content: ''; position: absolute; bottom: -5px; left: 50%; transform: translateX(-50%); width: 40px; height: 3px; background: var(--accent-color); border-radius: 2px; }
        .social-links { display: flex; gap: 20px; margin-top: 10px; }
        .social-btn { display: flex; align-items: center; justify-content: center; width: 50px; height: 50px; background: rgba(255, 255, 255, 0.05); border: 1px solid var(--border-color); border-radius: 50%; color: var(--text-muted); transition: all 0.3s ease; text-decoration: none; }
        .social-btn svg { width: 24px; height: 24px; fill: currentColor; }
        .social-btn:hover { background: #5865F2; color: white; border-color: #5865F2; transform: translateY(-3px); box-shadow: 0 0 15px rgba(88, 101, 242, 0.6); }
        .copyright { font-size: 12px; color: #666; margin-top: 10px; font-weight: 300; }
    </style>
</head>
<body>

<canvas id="effectsCanvas"></canvas>

<div id="specModal" class="modal">
    <span class="close-modal" onclick="closeModal()">&times;</span>
    <img class="modal-content" src="CNY_Price_Fixed.png" alt="Specs and Price">
</div>

<div class="container">
    <header>
        <img src="Personal_8.png" alt="Logo" class="main-logo">
        <button class="btn-specs" onclick="openModal()">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>
            สเปคและราคา
        </button>
    </header>

    <div class="tabs">
        <button class="tab-btn active" onclick="switchTab(1)">เครื่องที่ 1</button>
        <button class="tab-btn" onclick="switchTab(2)">เครื่องที่ 2</button>
        <button class="tab-btn" onclick="switchTab(3)">เครื่องที่ 3</button>
        <button class="tab-btn" onclick="switchTab(4)">เครื่องที่ 4</button>
    </div>

    <div class="schedule-header">
        <div id="monthDisplay" style="font-weight: 500; font-size: 20px; color: white;">กำลังโหลด...</div>
        <div class="legend">
            <div class="legend-item"><span class="dot" style="background:rgba(255,255,255,0.1);"></span> ว่าง</div>
            <div class="legend-item"><span class="dot" style="background:#B5251A;"></span> ไม่ว่าง</div>
        </div>
    </div>

    <div class="scroll-hint">← เลื่อนเพื่อดูเวลา →</div>

    <div class="schedule-container" id="scheduleGrid">
        <div class="radar-loader">
            <div class="radar-ring"></div><div class="radar-ring"></div><div class="radar-ring"></div><div class="radar-core"></div>
        </div>
        <div class="loading-text">กำลังค้นหาคิวว่าง...</div>
    </div>

    <div class="why-us-section">
        <h2 class="why-us-header">ทำไมต้องเลือกเรา?</h2>
        <div class="features-grid">
            <div class="feature-card fade-in-up">
                <svg class="feature-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M22 6h-2v11h-2v2h2a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2m-4 13V4a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v15a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2m-2-4H4V4h12v11z"/></svg>
                <div class="feature-title">สเปคระดับเทพ</div>
                <div class="feature-desc">ขับเคลื่อนด้วย <b>Ryzen 7 9800X3D</b> และ <b>RTX 5060</b> รีด FPS ได้สูงสุด เล่นลื่นทุกเกมแบบไม่มีสะดุด</div>
            </div>
            <div class="feature-card fade-in-up">
                <svg class="feature-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12c5.16-1.26 9-6.45 9-12V5l-9-4zm0 10.99h7c-.53 4.12-3.28 7.79-7 8.94V12H5V6.3l7-3.11v8.8z"/></svg>
                <div class="feature-title">ส่วนตัว & ปลอดภัย</div>
                <div class="feature-desc">ห้องส่วนตัวจำกัดเพียง 4 เครื่อง เงียบสงบ ไม่มีคนเดินพลุกพล่าน โฟกัสเกมได้เต็มที่เหมือนอยู่บ้าน</div>
            </div>
            <div class="feature-card fade-in-up">
                <svg class="feature-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M11.8 10.9c-2.27-.59-3-1.2-3-2.15c0-1.09 1.01-1.85 2.7-1.85c1.78 0 2.44.85 2.5 2.1h2.21c-.07-1.72-1.12-3.3-3.21-3.81V3h-3v2.16c-1.94.42-3.5 1.68-3.5 3.61c0 2.31 1.91 3.46 4.7 4.13c2.5.6 3 1.48 3 2.41c0 .69-.49 1.79-2.7 1.79c-2.06 0-2.87-.92-2.98-2.1h-2.2c.12 2.19 1.76 3.42 3.68 3.83V21h3v-2.15c1.95-.37 3.5-1.5 3.5-3.55c0-2.84-2.43-3.81-4.7-4.4z"/></svg>
                <div class="feature-title">คุ้มค่า ราคามิตรภาพ</div>
                <div class="feature-desc">เริ่มต้นเพียงชั่วโมงละ 40 บาท หรือเหมาวันก็ยิ่งคุ้ม ไฟดับ/เน็ตหลุด เราชดเชยเวลาให้ทันที</div>
            </div>
        </div>
    </div>

    <footer class="site-footer">
        <div class="footer-brand">Personal</div>
        <div class="social-links">
            <a href="https://discord.gg/34wFVqeNnW" target="_blank" class="social-btn" title="Join Discord">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.317 4.37a19.791 19.791 0 0 0-4.885-1.515a.074.074 0 0 0-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 0 0-5.487 0a12.64 12.64 0 0 0-.617-1.25a.077.077 0 0 0-.079-.037A19.736 19.736 0 0 0 3.677 4.37a.07.07 0 0 0-.032.027C.533 9.046-.32 13.58.099 18.057a.082.082 0 0 0 .031.057a19.9 19.9 0 0 0 5.993 3.03a.078.078 0 0 0 .084-.028a14.09 14.09 0 0 0 1.226-1.994a.076.076 0 0 0-.041-.106a13.107 13.107 0 0 1-1.872-.892a.077.077 0 0 1-.008-.128a10.2 10.2 0 0 0 .372-.292a.074.074 0 0 1 .077-.01c3.928 1.793 8.18 1.793 12.062 0a.074.074 0 0 1 .078.01c.12.098.246.198.373.292a.077.077 0 0 1-.006.127a12.299 12.299 0 0 1-1.873.892a.077.077 0 0 0-.041.107c.36.698.772 1.362 1.225 1.993a.076.076 0 0 0 .084.028a19.839 19.839 0 0 0 6.002-3.03a.077.077 0 0 0 .032-.054c.5-5.177-.838-9.674-3.549-13.66a.061.061 0 0 0-.031-.03zM8.02 15.33c-1.183 0-2.157-1.085-2.157-2.419c0-1.333.956-2.419 2.157-2.419c1.21 0 2.176 1.096 2.157 2.419c0 1.334-.956 2.419-2.157 2.419zm7.975 0c-1.183 0-2.157-1.085-2.157-2.419c0-1.333.955-2.419 2.157-2.419c1.21 0 2.176 1.096 2.157 2.419c0 1.334-.946 2.419-2.157 2.419z"/></svg>
            </a>
        </div>
        <div class="copyright">© 2026 Personal Queue System. All Rights Reserved.</div>
    </footer>
</div>

<script>
    const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzPAVsjR1wHYIbs5as6I7f5_3AVkpJZT0NkfkP2rEn0WizuiTzoZUXZMuo9kx08IJI/exec';

    let bookings = { 1: [], 2: [], 3: [], 4: [] }; 
    let currentMachine = 1;

    async function fetchBookings() {
        try {
            const response = await fetch(GOOGLE_SCRIPT_URL);
            const data = await response.json();
            bookings = { 1: [], 2: [], 3: [], 4: [] };
            data.forEach(item => {
                if(bookings[item.machine]) {
                    bookings[item.machine].push(item.slotId);
                }
            });
            console.log('Updated Bookings:', bookings);
            renderTable(currentMachine); 
            document.getElementById('scheduleGrid').classList.add('loaded');
        } catch (error) {
            console.error('Error fetching data:', error);
            document.getElementById('scheduleGrid').innerHTML = '<div style="color:red; text-align:center; padding:20px;">เกิดข้อผิดพลาดในการโหลดข้อมูล</div>';
        }
    }

    function renderTable(machineId) {
        const today = new Date();
        const monthsTH = ["ม.ค.", "ก.พ.", "มี.ค.", "เม.ย.", "พ.ค.", "มิ.ย.", "ก.ค.", "ส.ค.", "ก.ย.", "ต.ค.", "พ.ย.", "ธ.ค."];
        const currentMonthName = today.toLocaleDateString('th-TH', { month: 'long', year: 'numeric' });
        document.getElementById('monthDisplay').innerText = currentMonthName;

        // --- เงื่อนไขสำหรับเครื่องที่ 4 (Coming Soon) ---
        if (machineId === 4) {
             document.getElementById('scheduleGrid').innerHTML = `
                <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; height: 300px; color: var(--accent-gold); text-align: center;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" style="margin-bottom: 20px; filter: drop-shadow(0 0 10px rgba(255, 215, 0, 0.5));">
                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                        <line x1="16" y1="2" x2="16" y2="6"></line>
                        <line x1="8" y1="2" x2="8" y2="6"></line>
                        <line x1="3" y1="10" x2="21" y2="10"></line>
                    </svg>
                    <h2 style="font-size: 28px; font-weight: 500; margin: 0 0 10px 0; letter-spacing: 1px;">เร็วๆ นี้</h2>
                    <p style="color: var(--text-muted); font-size: 16px; max-width: 300px;">เครื่องที่ 4 กำลังอยู่ในระหว่างการติดตั้งและทดสอบระบบ เพื่อความเสถียรสูงสุด</p>
                </div>
             `;
             document.getElementById('scheduleGrid').classList.add('loaded');
             return;
        }

        const hours = [6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,0,1,2,3,4,5];
        let html = '<table><thead><tr><th>วันที่</th>';
        hours.forEach(h => { html += `<th>${h}:00</th>`; });
        html += '</tr></thead><tbody>';
        
        for (let i = -2; i < 7; i++) {
            let dateObj = new Date(today);
            dateObj.setDate(today.getDate() + i); 
            let rowDayNum = dateObj.getDate(); 
            let monthIndex = dateObj.getMonth();
            let dayStr = `${rowDayNum} ${monthsTH[monthIndex]}`;
            
            let rowStyle = (i === 0) ? 'style="background: rgba(255, 51, 51, 0.15);"' : '';

            html += `<tr ${rowStyle}><td style="font-weight:500; color:var(--text-main); white-space:nowrap;">${dayStr}</td>`;
            hours.forEach(h => {
                let checkDate = rowDayNum;
                if (h >= 0 && h <= 5) { checkDate = rowDayNum + 1; }
                const slotId = `${checkDate}-${h}`;
                const isOccupied = bookings[machineId] && bookings[machineId].includes(slotId);
                const className = isOccupied ? 'occupied' : 'available';
                const text = isOccupied ? 'เต็ม' : ''; 
                html += `<td class="time-slot ${className}">${text}</td>`;
            });
            html += '</tr>';
        }
        html += '</tbody></table>';
        document.getElementById('scheduleGrid').innerHTML = html;
        document.getElementById('scheduleGrid').classList.add('loaded');
    }

    function switchTab(machineId) {
        currentMachine = machineId;
        const buttons = document.querySelectorAll('.tab-btn');
        buttons.forEach((btn, index) => {
            if (index + 1 === machineId) btn.classList.add('active');
            else btn.classList.remove('active');
        });
        renderTable(machineId);
    }

    function openModal() { document.getElementById('specModal').style.display = 'block'; }
    function closeModal() { document.getElementById('specModal').style.display = 'none'; }
    window.onclick = function(event) { if (event.target == document.getElementById('specModal')) closeModal(); }

    fetchBookings();

    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => { if (entry.isIntersecting) entry.target.classList.add('show'); });
    }, { threshold: 0.1 });
    document.querySelectorAll('.feature-card').forEach((el) => { observer.observe(el); });

    // --- Chinese New Year Canvas Effect ---
    const canvas = document.getElementById('effectsCanvas');
    const ctx = canvas.getContext('2d');
    let w, h;
    
    const resize = () => { 
        w = canvas.width = window.innerWidth; 
        h = canvas.height = window.innerHeight; 
    };
    window.addEventListener('resize', resize);
    resize();

    // Palette: แดง ทอง ส้ม
    const cnyColors = ['#ff0000', '#ff4d4d', '#ffcc00', '#ffd700', '#ffb300'];

    // 1. Lanterns (โคมไฟ ลอยขึ้น)
    class Lantern {
        constructor() {
            this.reset();
            this.y = Math.random() * h; // เริ่มกระจายทั่วจอ
        }
        reset() {
            this.x = Math.random() * w;
            this.y = h + 50; 
            this.speed = Math.random() * 0.5 + 0.2; // ลอยช้าๆ
            this.sway = Math.random() * 0.02;
            this.angle = Math.random() * Math.PI * 2;
            this.radius = Math.random() * 8 + 5; // ขนาด
        }
        update() {
            this.y -= this.speed;
            this.angle += this.sway;
            this.x += Math.sin(this.angle) * 0.3; 
            if (this.y < -50) this.reset();
        }
        draw() {
            ctx.save();
            ctx.translate(this.x, this.y);
            // ตัวโคม
            ctx.fillStyle = '#D40000'; // แดงเข้ม
            ctx.beginPath();
            ctx.ellipse(0, 0, this.radius, this.radius * 0.8, 0, 0, Math.PI * 2);
            ctx.fill();
            // ขอบทองบนล่าง
            ctx.fillStyle = '#FFD700';
            ctx.fillRect(-this.radius/2, -this.radius, this.radius, 2); // บน
            ctx.fillRect(-this.radius/2, this.radius*0.8, this.radius, 2); // ล่าง
            // พู่ห้อย
            ctx.strokeStyle = '#FFD700';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(0, this.radius*0.8);
            ctx.lineTo(0, this.radius*2);
            ctx.stroke();
            ctx.restore();
        }
    }

    // 2. Gold Dust (ละอองทอง ตกลงมา)
    class GoldParticle {
        constructor() {
            this.x = Math.random() * w;
            this.y = Math.random() * h;
            this.size = Math.random() * 2 + 1;
            this.speedY = Math.random() * 1 + 0.5;
            this.speedX = (Math.random() - 0.5) * 0.5;
            this.color = '#FFD700';
            this.alpha = Math.random() * 0.5 + 0.5;
        }
        update() {
            this.y += this.speedY;
            this.x += this.speedX;
            if (this.y > h) {
                this.y = 0;
                this.x = Math.random() * w;
            }
        }
        draw() {
            ctx.fillStyle = `rgba(255, 215, 0, ${this.alpha})`;
            ctx.beginPath();
            ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
            ctx.fill();
        }
    }

    // 3. Fireworks (พลุ เหมือนเดิมแต่เปลี่ยนสีเป็นธีมตรุษจีน)
    let fireworks = [];
    let particles = [];
    class Firework {
        constructor() {
            this.x = Math.random() * w;
            this.y = h;
            this.targetY = Math.random() * (h * 0.4) + (h * 0.1);
            this.speed = 8;
            this.radius = 3;
            // สุ่มสี แดง หรือ ทอง
            this.color = Math.random() > 0.5 ? '#FF0000' : '#FFD700';
        }
        update(index) {
            this.y -= this.speed;
            if (this.y <= this.targetY) {
                fireworks.splice(index, 1);
                createParticles(this.x, this.y, this.color);
            }
        }
        draw() {
            ctx.beginPath();
            ctx.arc(this.x, this.y, this.radius, 0, Math.PI*2);
            ctx.fillStyle = this.color;
            ctx.fill();
        }
    }
    class Spark {
        constructor(x, y, color) {
            this.x = x; this.y = y; this.color = color;
            this.radius = Math.random() * 2 + 1;
            const angle = Math.random() * Math.PI * 2;
            const speed = Math.random() * 5 + 2;
            this.vx = Math.cos(angle) * speed;
            this.vy = Math.sin(angle) * speed;
            this.gravity = 0.05; this.friction = 0.96;
            this.alpha = 1; this.decay = Math.random() * 0.02 + 0.01;
        }
        update(index) {
            this.vx *= this.friction; this.vy *= this.friction;
            this.vy += this.gravity;
            this.x += this.vx; this.y += this.vy;
            this.alpha -= this.decay;
            if (this.alpha <= 0) particles.splice(index, 1);
        }
        draw() {
            ctx.save();
            ctx.globalAlpha = this.alpha;
            ctx.beginPath();
            ctx.arc(this.x, this.y, this.radius, 0, Math.PI*2);
            ctx.fillStyle = this.color;
            ctx.fill();
            ctx.restore();
        }
    }
    function createParticles(x, y, color) {
        for (let i = 0; i < 40; i++) particles.push(new Spark(x, y, color));
    }

    // สร้าง Object
    const lanterns = [];
    for(let i=0; i<30; i++) lanterns.push(new Lantern()); // โคมไฟ 30 ดวง
    const goldDust = [];
    for(let i=0; i<60; i++) goldDust.push(new GoldParticle()); // ละอองทอง 60 จุด

    function animate() {
        requestAnimationFrame(animate);
        ctx.fillStyle = 'rgba(20, 5, 5, 0.2)'; // ลบรอยเก่าด้วยสีแดงเข้มจางๆ
        ctx.fillRect(0, 0, w, h);

        lanterns.forEach(l => { l.update(); l.draw(); });
        goldDust.forEach(g => { g.update(); g.draw(); });

        if (Math.random() < 0.02) fireworks.push(new Firework());
        fireworks.forEach((f, i) => { f.update(i); f.draw(); });
        particles.forEach((p, i) => { p.update(i); p.draw(); });
    }
    animate();
</script>

</body>
</html>